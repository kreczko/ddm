# ddm
Directional Dark Matter Research Project

Gabriel Penn and Will Sugg (Bristol MSci final year project students 2016/17)

## Running the simulation
This guide outlines the basic steps you will need to take to run the DDM simulation once you have a local clone of this repository. (Please note that this guide assumes you are working on soolin.dice.priv, and may not work on other machines.)

### Environment setup (once per login)

A shell script is provided to set up the necessary Geant4 and ROOT environment using libraries from cvmfs.

From the ddm directory:
```bash
source init/init_geant4_plus_ROOT.sh
```

### Building the simulation (once, unless changes are made to the source code)

You may wish to use the shell script provided (ddm/DDM/DDM_build.sh) to build the simulation, but this assumes that your clone of the ddm repository is located in your home directory, and that you have created the expected build directory (~/geant4/DDM-build).

Otherwise, execute the following commands in the directory of your choice:

```bash
mkdir _build
cd _build
cmake -DGeant4_DIR=/cvmfs/geant4.cern.ch/geant4/10.2.p02/x86_64-slc6-gcc49-opt/lib64/ ../DDM
make -j2
```

(Note: a lot of warnings may appear; these can be safely ignored, as long as the build is successful.)

### Running the simulation in interactive mode

From the build directory:

```bash
./DDM
```

This should open a interactive window with visualisation. Events can be generated by executing a macro through the built-in command line, e.g.

```
/control/execute testArgon.mac
```

Other Geant4 commands can be found [here](http://geant4.cern.ch/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/Control/commands.html).

### Running the simulation in batch mode

Using one or more command line arguments wil bypass the interface window and run the program in batch mode. Commands include:
 - -m [macro file]: run the specified macro
 - -p [parameter file]: use the specified parameter file (pressure and time resolution are currently the only parameters specifiable by file)
 - -r [seed]: set the RNG seed
 - -s 1: activate 'streamlining', speeding up the simulation and restricting file output to contain only the event results tree
 - -storage 1: save output file to the project storage directory instead of the build directory (do not use, unless you have modified the code to save to your own storage directory)

### Results

Results, including camera image histograms, are saved to a ROOT file named according to the pressure and time resolution used.


## Modifying the simulation

The sensitive volume is currently set to contain gaseous argon. The following parts of the simulation are specific to argon, and would have to be modified if the sensitive material is to be changed :

  - The generation of the drift electrons, which uses the ionisation energy of argon
  - The equation used to calculate the electron drift velocity, obtained from [1]
  - The equation used to calculate the yield of scintillation photons generated per drift electron, obtained from [2]

References

[1] C. M. B. Monteiro, et al., ”Secondary scintillation yield in pure argon”, Phys. Lett. B, 668, 167 (2008)  
		[http://www.sciencedirect.com/science/article/pii/S0370269308010435]  
[2] V. Lisovskiy, et al., ”Electron drift velocity in argon, nitrogen, hydrogen, oxygen and ammonia in strong electric fields determined from rf breakdown curves”, J. Phys. D: Appl. Phys., 39, 660 (2006)
		[http://iopscience.iop.org/article/10.1088/0022-3727/39/4/011/meta]

## Vagrant instructions
In order to run DDM on your own machine with Vagrant, you need to
1. Install [Virtualbox](https://www.virtualbox.org/wiki/Downloads)
2. Install [Vagrant](https://www.vagrantup.com/downloads.html)
The Vagrant box in use is the CernVM.

**NOTE:** By default this setup will use 2 cores and 2 GB of RAM. If you want to adjust these numbers, please edit the Vagrantfile before continuing.

Next
1. Clone repository
2. Open terminal (or powershell on Windows)
3. cd into the project directory
4.
```bash
vagrant up # can take a while
vagrant ssh
cd /vagrant
```

You should be now in the project directory but within a Scientific Linux 6 environment
with access to the CernVM File System (CVMFS). Follow the instructions from *Environment setup (once per login)*.
